<?xml version="1.0" encoding="utf-8"?>
<Template>
  <Name>My Orders</Name>
  <Alias>MyOrders</Alias>
  <Design><![CDATA[@using RM.MailshotsOnline.Web.Extensions
@using ClientDependency.Core.Mvc
@inherits Glass.Mapper.Umb.Web.Ui.GlassViewPage<RM.MailshotsOnline.Entities.PageModels.MyOrders>
@{
    Layout = "Master.cshtml";
    Html.RequiresCss("~/css/orders.css", 2);
    var orderDetailsPage = Umbraco.Content(Model.OrderDetailsPage);
    var orderDetailsUrl = orderDetailsPage.Url;// Model.OrderDetailsPage.Url(); //.CampaignHubPage.Url();
}

<div class="content my-orders">
    @if (Model.Campaigns.Count() > 0)
    {
        <h1>@Model.Name (@Model.ActiveCampaignCount @Model.ActiveLabel)</h1>
        foreach (var campaign in Model.Campaigns)
        {
            <div class="order">
                <div class="preview"></div>
                <div class="actions">
                    @if (campaign.Status == RM.MailshotsOnline.PCL.Enums.CampaignStatus.PendingModeration)
                    {
                    <a href="#cancel">Cancel</a>
                    }
                    @if (campaign.Status == RM.MailshotsOnline.PCL.Enums.CampaignStatus.Fulfilled)
                    {
                    <a href="#downloadInvoice">Invoice</a>
                    }
                </div>
                <h2><a href="@string.Format("{0}?campaignId={1}", orderDetailsUrl, campaign.CampaignId)">@campaign.Name</a></h2>
                <div class="status @campaign.Status.ToString()">
                    <h3>@Model.GetStatusText(campaign)</h3>
                    <p>@Html.Raw(Model.GetStatusDescription(campaign))</p>
                </div>
                <div class="info">
                    <span>@Model.OrderPlacedLabel @campaign.LatestInvoice().CreatedDate.ToString("dd/MM/yy")</span>
                    <span>@Model.OrderNumberLabel @Html.Raw(string.IsNullOrEmpty(campaign.LatestInvoice().OrderNumber) ? campaign.LatestInvoice().PaypalOrderId : campaign.LatestInvoice().OrderNumber)</span>
                    <span>@Model.TotalLabel &pound;@campaign.LatestInvoice().Total.ToString("F2")</span>
                </div>
            </div>
        }
    }
    else
    {
        <h1>@Model.Name</h1>
        <div>@Umbraco.Field("noOrdersMessage")</div>
    }
</div>]]></Design>
</Template>